# 对白归属 Skill

## 概述

这个 skill 通过 **AI 直接决策**的方式进行对话归属，而不是使用自动化脚本。

## 工作流程

1. **阅读章节**：Claude 阅读章节内容，理解情节和对话流
2. **识别说话者**：根据上下文、对话标记和角色关系判断说话者
3. **归属对话**：将每段文本归属到旁白或具体角色
4. **情绪标注**：根据对话内容和上下文判断情绪
5. **手动创建**：直接创建 JSON 文件，包含所有归属信息

## 优势

相比自动化脚本：
- ✓ 更准确的说话者识别（理解上下文，不会误判）
- ✓ 更合理的情绪标注（基于情节理解，不是关键词匹配）
- ✓ 更灵活的边界划分（保持自然段落）
- ✓ 处理复杂对话（连续对话、隐含说话者等）

## 使用方法

```bash
claude-code /attribute-dialogue
```

Claude 会：
1. 读取 `source/01_extracted/chapters.json`
2. 读取 `source/02_casting/character_list.json` 和 `voice_mapping.json`
3. 逐章分析并归属对话
4. 创建输出文件到 `source/03_segmentation/attributed_chapters.json`

## 输出格式

### attributed_chapters.json
包含所有章节的对话归属：
- 每个片段的类型（narration/dialogue）
- 说话者 ID 和名称
- 文本内容和字数
- 情绪标签（对于对话）

## 归属原则

1. **旁白识别**：叙述性文字、场景描述、心理活动
2. **对话识别**：有引号或明确说话标记的文字
3. **说话者判断**：根据对话标记、上下文、角色关系
4. **情绪标注**：保持克制风格（low intensity）
5. **自然边界**：保持段落的完整性

## 示例

对于文本：
```
周启明冷笑一声，"你以为我会相信你？"
沈知夏平静地看着他，"信不信由你。"
```

归属为：
- 旁白："周启明冷笑一声，" (narrator)
- 对话："你以为我会相信你？" (char_001, angry)
- 旁白："沈知夏平静地看着他，" (narrator)
- 对话："信不信由你。" (char_002, neutral)

## 注意事项

- 这个 skill 需要 Claude 仔细阅读所有章节内容
- 对于长篇小说，处理时间可能较长
- 输出的归属可以手动调整
- 如果对归属不满意，可以直接编辑 JSON 文件
